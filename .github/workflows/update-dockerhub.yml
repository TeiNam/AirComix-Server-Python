name: Update Docker Hub README

on:
  push:
    branches:
      - main
    paths:
      - 'README.md'
      - 'docker/**'
  release:
    types: [published]
  workflow_dispatch:

jobs:
  update-dockerhub-readme:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Generate Docker Hub README
      run: |
        cat > DOCKER_README.md << 'EOF'
        # AirComix Server - Python Port
        
        [![Docker Pulls](https://img.shields.io/docker/pulls/${{ secrets.DOCKERHUB_USERNAME }}/aircomix-server)](https://hub.docker.com/r/${{ secrets.DOCKERHUB_USERNAME }}/aircomix-server)
        [![Docker Image Size](https://img.shields.io/docker/image-size/${{ secrets.DOCKERHUB_USERNAME }}/aircomix-server/latest)](https://hub.docker.com/r/${{ secrets.DOCKERHUB_USERNAME }}/aircomix-server)
        [![GitHub](https://img.shields.io/github/license/TeiNam/AirComix-Server-Python)](https://github.com/TeiNam/AirComix-Server-Python)
        
        AirComix iOS ì•±ê³¼ 100% í˜¸í™˜ë˜ëŠ” ë§Œí™”ì±… ìŠ¤íŠ¸ë¦¬ë° ì„œë²„ì˜ Python í¬íŠ¸ìž…ë‹ˆë‹¤.
        
        ## ðŸš€ ë¹ ë¥¸ ì‹œìž‘
        
        ### ê¸°ë³¸ ì‹¤í–‰
        ```bash
        docker run -d \
          --name aircomix-server \
          -p 31257:31257 \
          -v /path/to/your/comix:/comix \
          ${{ secrets.DOCKERHUB_USERNAME }}/aircomix-server:latest
        ```
        
        ### ì¸ì¦ í™œì„±í™”
        ```bash
        docker run -d \
          --name aircomix-server \
          -p 31257:31257 \
          -v /path/to/your/comix:/comix \
          -e COMIX_ENABLE_AUTH=true \
          -e COMIX_AUTH_PASSWORD=your_secure_password \
          ${{ secrets.DOCKERHUB_USERNAME }}/aircomix-server:latest
        ```
        
        ### Docker Compose ì‚¬ìš©
        ```yaml
        version: '3.8'
        services:
          aircomix-server:
            image: ${{ secrets.DOCKERHUB_USERNAME }}/aircomix-server:latest
            container_name: aircomix-server
            ports:
              - "31257:31257"
            volumes:
              - /path/to/your/comix:/comix:ro
            environment:
              - COMIX_ENABLE_AUTH=false
            restart: unless-stopped
        ```
        
        ## ðŸ“‹ ì§€ì› íŒŒì¼ í˜•ì‹
        
        ### ì´ë¯¸ì§€ íŒŒì¼
        - JPEG, PNG, GIF, BMP, TIFF, WebP
        
        ### ì•„ì¹´ì´ë¸Œ íŒŒì¼
        - ZIP, RAR, CBZ, CBR
        
        ## âš™ï¸ í™˜ê²½ ë³€ìˆ˜
        
        | ë³€ìˆ˜ëª… | ê¸°ë³¸ê°’ | ì„¤ëª… |
        |--------|--------|------|
        | `COMIX_MANGA_DIRECTORY` | `/comix` | ë§Œí™” íŒŒì¼ ë””ë ‰í† ë¦¬ |
        | `COMIX_SERVER_PORT` | `31257` | ì„œë²„ í¬íŠ¸ |
        | `COMIX_DEBUG_MODE` | `false` | ë””ë²„ê·¸ ëª¨ë“œ |
        | `COMIX_LOG_LEVEL` | `INFO` | ë¡œê·¸ ë ˆë²¨ |
        | `COMIX_ENABLE_AUTH` | `false` | ê¸°ë³¸ ì¸ì¦ í™œì„±í™” |
        | `COMIX_AUTH_PASSWORD` | - | ì¸ì¦ íŒ¨ìŠ¤ì›Œë“œ |
        
        ## ðŸ·ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ íƒœê·¸
        
        - `latest` - ìµœì‹  ì•ˆì • ë²„ì „
        - `dev` - ê°œë°œ ë²„ì „
        - `v1.x.x` - íŠ¹ì • ë²„ì „
        
        ## ðŸ”— ë§í¬
        
        - **GitHub**: https://github.com/TeiNam/AirComix-Server-Python
        - **AirComix iOS ì•±**: https://apps.apple.com/app/aircomix/
        - **ë¬¸ì œ ë³´ê³ **: https://github.com/TeiNam/AirComix-Server-Python/issues
        
        ## ðŸ“„ ë¼ì´ì„ ìŠ¤
        
        MIT License - ìžì„¸í•œ ë‚´ìš©ì€ [LICENSE](https://github.com/TeiNam/AirComix-Server-Python/blob/main/LICENSE) ì°¸ì¡°
        EOF

    - name: Update Docker Hub Description
      uses: peter-evans/dockerhub-description@v3
      with:
        username: ${{ secrets.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}
        repository: ${{ secrets.DOCKERHUB_USERNAME }}/aircomix-server
        readme-filepath: ./DOCKER_README.md